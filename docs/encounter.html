<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Lesson 10 Encounter Rate | eBird Best Practices Workshop</title>
  <meta name="description" content="Best practices for using eBird data to estimate species distributions" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Lesson 10 Encounter Rate | eBird Best Practices Workshop" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Best practices for using eBird data to estimate species distributions" />
  <meta name="github-repo" content="mstrimas/ebp-workshop" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Lesson 10 Encounter Rate | eBird Best Practices Workshop" />
  
  <meta name="twitter:description" content="Best practices for using eBird data to estimate species distributions" />
  

<meta name="author" content="Matthew Strimas-Mackey, Alison Johnston, Wesley M. Hochachka, Viviana Ruiz-Gutierrez, Orin J. Robinson, Eliot T. Miller, Tom Auer, Steve Kelling, Daniel Fink" />


<meta name="date" content="2020-03-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-intro.html"/>
<link rel="next" href="occupancy.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">eBird Best Practices Workshop</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#intro-data"><i class="fa fa-check"></i><b>1.1</b> Data</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#intro-format"><i class="fa fa-check"></i><b>1.2</b> Format</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#intro-setup"><i class="fa fa-check"></i><b>1.3</b> Setup</a></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#intro-tidyverse"><i class="fa fa-check"></i><b>1.4</b> Tidyverse</a></li>
</ul></li>
<li class="part"><span><b>I eBird Data</b></span></li>
<li class="chapter" data-level="2" data-path="ebird-intro.html"><a href="ebird-intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="ebird-intro.html"><a href="ebird-intro.html#the-auk-workflow"><i class="fa fa-check"></i><b>2.1</b> The <code>auk</code> workflow</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="access.html"><a href="access.html"><i class="fa fa-check"></i><b>3</b> Data Access</a></li>
<li class="chapter" data-level="4" data-path="filter.html"><a href="filter.html"><i class="fa fa-check"></i><b>4</b> Filtering</a><ul>
<li class="chapter" data-level="4.1" data-path="filter.html"><a href="filter.html#filter-define"><i class="fa fa-check"></i><b>4.1</b> Defining filters</a><ul>
<li class="chapter" data-level="4.1.1" data-path="filter.html"><a href="filter.html#filter-define-complete"><i class="fa fa-check"></i><b>4.1.1</b> Complete checklists</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="filter.html"><a href="filter.html#filter-execute"><i class="fa fa-check"></i><b>4.2</b> Execute filters</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="import.html"><a href="import.html"><i class="fa fa-check"></i><b>5</b> Importing Data</a><ul>
<li class="chapter" data-level="5.1" data-path="import.html"><a href="import.html#import-group"><i class="fa fa-check"></i><b>5.1</b> Group checklists</a></li>
<li class="chapter" data-level="5.2" data-path="import.html"><a href="import.html#import-taxonomy"><i class="fa fa-check"></i><b>5.2</b> Taxonomy</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="presabs.html"><a href="presabs.html"><i class="fa fa-check"></i><b>6</b> Presence-absence Data</a><ul>
<li class="chapter" data-level="6.1" data-path="presabs.html"><a href="presabs.html#presabs-filter"><i class="fa fa-check"></i><b>6.1</b> Filtering</a></li>
<li class="chapter" data-level="6.2" data-path="presabs.html"><a href="presabs.html#presabs-zerofill"><i class="fa fa-check"></i><b>6.2</b> Zero-filling</a></li>
<li class="chapter" data-level="6.3" data-path="presabs.html"><a href="presabs.html#presabs-tidy"><i class="fa fa-check"></i><b>6.3</b> Tidying up</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="subsampling.html"><a href="subsampling.html"><i class="fa fa-check"></i><b>7</b> Spatiotemporal Subsampling</a><ul>
<li class="chapter" data-level="7.1" data-path="subsampling.html"><a href="subsampling.html#subsampling-toy"><i class="fa fa-check"></i><b>7.1</b> A toy example</a></li>
<li class="chapter" data-level="7.2" data-path="subsampling.html"><a href="subsampling.html#subsampling-ebird"><i class="fa fa-check"></i><b>7.2</b> Subsampling eBird data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>8</b> Applications</a><ul>
<li class="chapter" data-level="8.1" data-path="applications.html"><a href="applications.html#applications-trajectory"><i class="fa fa-check"></i><b>8.1</b> Frequency trajectories</a></li>
<li class="chapter" data-level="8.2" data-path="applications.html"><a href="applications.html#applications-maps"><i class="fa fa-check"></i><b>8.2</b> Maps</a></li>
</ul></li>
<li class="part"><span><b>II Distribution Modeling</b></span></li>
<li class="chapter" data-level="9" data-path="model-intro.html"><a href="model-intro.html"><i class="fa fa-check"></i><b>9</b> Introduction</a><ul>
<li class="chapter" data-level="9.1" data-path="model-intro.html"><a href="model-intro.html#model-intro-data"><i class="fa fa-check"></i><b>9.1</b> Example data</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="encounter.html"><a href="encounter.html"><i class="fa fa-check"></i><b>10</b> Encounter Rate</a><ul>
<li class="chapter" data-level="10.1" data-path="encounter.html"><a href="encounter.html#encounter-prep"><i class="fa fa-check"></i><b>10.1</b> Data preparation</a></li>
<li class="chapter" data-level="10.2" data-path="encounter.html"><a href="encounter.html#encounter-rf"><i class="fa fa-check"></i><b>10.2</b> Random forests</a><ul>
<li class="chapter" data-level="10.2.1" data-path="encounter.html"><a href="encounter.html#encounter-rf-assess"><i class="fa fa-check"></i><b>10.2.1</b> Model assessment</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="encounter.html"><a href="encounter.html#encounter-habitat"><i class="fa fa-check"></i><b>10.3</b> Habitat associations</a><ul>
<li class="chapter" data-level="10.3.1" data-path="encounter.html"><a href="encounter.html#encounter-habitat-pi"><i class="fa fa-check"></i><b>10.3.1</b> Predictor importance</a></li>
<li class="chapter" data-level="10.3.2" data-path="encounter.html"><a href="encounter.html#encounter-habitat-pd"><i class="fa fa-check"></i><b>10.3.2</b> Partial dependence</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="encounter.html"><a href="encounter.html#encounter-predict"><i class="fa fa-check"></i><b>10.4</b> Prediction</a></li>
<li class="chapter" data-level="10.5" data-path="encounter.html"><a href="encounter.html#encouter-exercises"><i class="fa fa-check"></i><b>10.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="occupancy.html"><a href="occupancy.html"><i class="fa fa-check"></i><b>11</b> Occupancy</a><ul>
<li class="chapter" data-level="11.1" data-path="occupancy.html"><a href="occupancy.html#occupancy-prep"><i class="fa fa-check"></i><b>11.1</b> Data preparation</a></li>
<li class="chapter" data-level="11.2" data-path="occupancy.html"><a href="occupancy.html#occupancy-model"><i class="fa fa-check"></i><b>11.2</b> Occupancy modeling</a><ul>
<li class="chapter" data-level="11.2.1" data-path="occupancy.html"><a href="occupancy.html#occupancy-model-assess"><i class="fa fa-check"></i><b>11.2.1</b> Assessment</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="occupancy.html"><a href="occupancy.html#occupancy-predict"><i class="fa fa-check"></i><b>11.3</b> Prediction</a></li>
<li class="chapter" data-level="11.4" data-path="occupancy.html"><a href="occupancy.html#occupancy-exercises"><i class="fa fa-check"></i><b>11.4</b> Exercises</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">eBird Best Practices Workshop</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="encounter" class="section level1">
<h1><span class="header-section-number">Lesson 10</span> Encounter Rate</h1>
<p>In this lesson, we’ll estimate the <strong>encounter rate</strong> of Wood Thrush on eBird checklists in June in BCR 27, where encounter rate is defined as the probability of an eBirder encountering a species on a standard eBird checklist. We’ll be using random forests in this lesson, a machine learning technique that uses an ensemble of many decision trees, each of which is fit using a bootstrap sampled of the data. For the purposes of this tutorial, we’ll treat the random forest as a black box method.</p>
<p>Let’s start by loading all the packages and data we’ll need for this lesson.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="encounter.html#cb54-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb54-2"><a href="encounter.html#cb54-2"></a><span class="kw">library</span>(raster)</span>
<span id="cb54-3"><a href="encounter.html#cb54-3"></a><span class="kw">library</span>(dggridR)</span>
<span id="cb54-4"><a href="encounter.html#cb54-4"></a><span class="kw">library</span>(lubridate)</span>
<span id="cb54-5"><a href="encounter.html#cb54-5"></a><span class="kw">library</span>(ranger)</span>
<span id="cb54-6"><a href="encounter.html#cb54-6"></a><span class="kw">library</span>(scam)</span>
<span id="cb54-7"><a href="encounter.html#cb54-7"></a><span class="kw">library</span>(PresenceAbsence)</span>
<span id="cb54-8"><a href="encounter.html#cb54-8"></a><span class="kw">library</span>(verification)</span>
<span id="cb54-9"><a href="encounter.html#cb54-9"></a><span class="kw">library</span>(edarf)</span>
<span id="cb54-10"><a href="encounter.html#cb54-10"></a><span class="kw">library</span>(ebirdst)</span>
<span id="cb54-11"><a href="encounter.html#cb54-11"></a><span class="kw">library</span>(fields)</span>
<span id="cb54-12"><a href="encounter.html#cb54-12"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb54-13"><a href="encounter.html#cb54-13"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb54-14"><a href="encounter.html#cb54-14"></a><span class="co"># resolve namespace conflicts</span></span>
<span id="cb54-15"><a href="encounter.html#cb54-15"></a>select &lt;-<span class="st"> </span>dplyr<span class="op">::</span>select</span>
<span id="cb54-16"><a href="encounter.html#cb54-16"></a>projection &lt;-<span class="st"> </span>raster<span class="op">::</span>projection</span>
<span id="cb54-17"><a href="encounter.html#cb54-17"></a>map &lt;-<span class="st"> </span>purrr<span class="op">::</span>map</span>
<span id="cb54-18"><a href="encounter.html#cb54-18"></a></span>
<span id="cb54-19"><a href="encounter.html#cb54-19"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb54-20"><a href="encounter.html#cb54-20"></a></span>
<span id="cb54-21"><a href="encounter.html#cb54-21"></a><span class="co"># ebird data</span></span>
<span id="cb54-22"><a href="encounter.html#cb54-22"></a>ebird &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/ebd_woothr_june_bcr27_zf.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-23"><a href="encounter.html#cb54-23"></a><span class="st">  </span><span class="co"># year required to join to habitat data</span></span>
<span id="cb54-24"><a href="encounter.html#cb54-24"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">year</span>(observation_date))</span>
<span id="cb54-25"><a href="encounter.html#cb54-25"></a></span>
<span id="cb54-26"><a href="encounter.html#cb54-26"></a><span class="co"># modis habitat covariates</span></span>
<span id="cb54-27"><a href="encounter.html#cb54-27"></a>habitat &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/pland-elev_location-year.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-28"><a href="encounter.html#cb54-28"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.integer</span>(year))</span>
<span id="cb54-29"><a href="encounter.html#cb54-29"></a></span>
<span id="cb54-30"><a href="encounter.html#cb54-30"></a><span class="co"># combine ebird and habitat data</span></span>
<span id="cb54-31"><a href="encounter.html#cb54-31"></a>ebird_habitat &lt;-<span class="st"> </span><span class="kw">inner_join</span>(ebird, habitat, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;locality_id&quot;</span>, <span class="st">&quot;year&quot;</span>))</span>
<span id="cb54-32"><a href="encounter.html#cb54-32"></a></span>
<span id="cb54-33"><a href="encounter.html#cb54-33"></a><span class="co"># prediction surface</span></span>
<span id="cb54-34"><a href="encounter.html#cb54-34"></a>pred_surface &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/pland-elev_prediction-surface.csv&quot;</span>)</span>
<span id="cb54-35"><a href="encounter.html#cb54-35"></a>r &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/prediction-surface.tif&quot;</span>)</span>
<span id="cb54-36"><a href="encounter.html#cb54-36"></a></span>
<span id="cb54-37"><a href="encounter.html#cb54-37"></a><span class="co"># load gis data for making maps</span></span>
<span id="cb54-38"><a href="encounter.html#cb54-38"></a>map_proj &lt;-<span class="st"> </span><span class="kw">st_crs</span>(<span class="dv">102003</span>)</span>
<span id="cb54-39"><a href="encounter.html#cb54-39"></a>ne_land &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="st">&quot;data/gis-data.gpkg&quot;</span>, <span class="st">&quot;ne_land&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-40"><a href="encounter.html#cb54-40"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> map_proj) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-41"><a href="encounter.html#cb54-41"></a><span class="st">  </span><span class="kw">st_geometry</span>()</span>
<span id="cb54-42"><a href="encounter.html#cb54-42"></a>bcr &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="st">&quot;data/gis-data.gpkg&quot;</span>, <span class="st">&quot;bcr&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-43"><a href="encounter.html#cb54-43"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> map_proj) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-44"><a href="encounter.html#cb54-44"></a><span class="st">  </span><span class="kw">st_geometry</span>()</span>
<span id="cb54-45"><a href="encounter.html#cb54-45"></a>ne_country_lines &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="st">&quot;data/gis-data.gpkg&quot;</span>, <span class="st">&quot;ne_country_lines&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-46"><a href="encounter.html#cb54-46"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> map_proj) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-47"><a href="encounter.html#cb54-47"></a><span class="st">  </span><span class="kw">st_geometry</span>()</span>
<span id="cb54-48"><a href="encounter.html#cb54-48"></a>ne_state_lines &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="st">&quot;data/gis-data.gpkg&quot;</span>, <span class="st">&quot;ne_state_lines&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-49"><a href="encounter.html#cb54-49"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> map_proj) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb54-50"><a href="encounter.html#cb54-50"></a><span class="st">  </span><span class="kw">st_geometry</span>()</span></code></pre></div>
<div id="encounter-prep" class="section level2">
<h2><span class="header-section-number">10.1</span> Data preparation</h2>
<p>As we learned in <a href="subsampling.html#subsampling">Part I</a> of this workshop, spatiotemporal subsampling can reduce spatial and temporal bias, and class imbalance, provided we sample detections and non-detections separately. So, we’ll apply subsampling prior to fitting the random forest model.</p>
<div class="tip">
<h2>
Tip
</h2>
<p>Sampling detections and non-detections separately will change the prevalence rate of the detections in the data. As a result, the estimated probability of occurrence based on these subsampled data will be larger than the true occurrence rate. When examining the outputs from the models it will be important to recall that we altered the prevalence rate at this stage.</p>
</div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="encounter.html#cb55-1"></a><span class="co"># generate hexagonal grid with ~ 5 km betweeen cells</span></span>
<span id="cb55-2"><a href="encounter.html#cb55-2"></a>dggs &lt;-<span class="st"> </span><span class="kw">dgconstruct</span>(<span class="dt">spacing =</span> <span class="dv">5</span>)</span>
<span id="cb55-3"><a href="encounter.html#cb55-3"></a><span class="co">#&gt; Resolution: 13, Area (km^2): 31.9926151554038, Spacing (km): 5.58632116604266, CLS (km): 6.38233997895802</span></span>
<span id="cb55-4"><a href="encounter.html#cb55-4"></a><span class="co"># get hexagonal cell id and week number for each checklist</span></span>
<span id="cb55-5"><a href="encounter.html#cb55-5"></a>checklist_cell &lt;-<span class="st"> </span>ebird_habitat <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb55-6"><a href="encounter.html#cb55-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cell =</span> <span class="kw">dgGEO_to_SEQNUM</span>(dggs, longitude, latitude)<span class="op">$</span>seqnum,</span>
<span id="cb55-7"><a href="encounter.html#cb55-7"></a>         <span class="dt">year =</span> <span class="kw">year</span>(observation_date),</span>
<span id="cb55-8"><a href="encounter.html#cb55-8"></a>         <span class="dt">week =</span> <span class="kw">week</span>(observation_date))</span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode r livecode"><code class="sourceCode r"><span id="cb56-1"><a href="encounter.html#cb56-1"></a><span class="co"># sample one checklist per grid cell per week</span></span>
<span id="cb56-2"><a href="encounter.html#cb56-2"></a><span class="co"># sample detection/non-detection independently </span></span>
<span id="cb56-3"><a href="encounter.html#cb56-3"></a>ebird_ss &lt;-<span class="st"> </span>checklist_cell <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb56-4"><a href="encounter.html#cb56-4"></a><span class="st">  </span><span class="kw">group_by</span>(species_observed, year, week, cell) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb56-5"><a href="encounter.html#cb56-5"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb56-6"><a href="encounter.html#cb56-6"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<div class="tip">
<h2>
Tip
</h2>
<p>For very rare species, a more drastic approach to dealing with class imbalance is needed: only subsampling the non-detections and keeping all the detections. Here’s one way of accomplishing this.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="encounter.html#cb57-1"></a>split_det &lt;-<span class="st"> </span><span class="kw">split</span>(checklist_cell, checklist_cell<span class="op">$</span>species_observed)</span>
<span id="cb57-2"><a href="encounter.html#cb57-2"></a>ebird_all_det &lt;-<span class="st"> </span>split_det<span class="op">$</span><span class="st">`</span><span class="dt">FALSE</span><span class="st">`</span> <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-3"><a href="encounter.html#cb57-3"></a><span class="st">  </span><span class="kw">group_by</span>(year, week, cell) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-4"><a href="encounter.html#cb57-4"></a><span class="st">  </span><span class="kw">sample_n</span>(<span class="dt">size =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-5"><a href="encounter.html#cb57-5"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb57-6"><a href="encounter.html#cb57-6"></a><span class="st">  </span><span class="kw">bind_rows</span>(split_det<span class="op">$</span><span class="st">`</span><span class="dt">TRUE</span><span class="st">`</span>)</span></code></pre></div>
<p>This approach leads to many more detections being kept in the data.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="encounter.html#cb58-1"></a><span class="kw">sum</span>(ebird_ss<span class="op">$</span>species_observed)</span>
<span id="cb58-2"><a href="encounter.html#cb58-2"></a><span class="co">#&gt; [1] 1425</span></span>
<span id="cb58-3"><a href="encounter.html#cb58-3"></a><span class="kw">sum</span>(ebird_all_det<span class="op">$</span>species_observed)</span>
<span id="cb58-4"><a href="encounter.html#cb58-4"></a><span class="co">#&gt; [1] 2013</span></span></code></pre></div>
<p>However, some of the extra detections we have with this approach are in the same 5km cell and the same week, they may not be independent. There are trade-offs to many of these decisions about post-hoc sampling.</p>
</div>
</div>
<p>In preparation for modeling, we’ll select only the the columns that will be used as predictors in the model. We include both habitat predictors, which we expect to influence whether a species is present at a site, and also effort predictors to help control for variation in detectability.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r livecode"><code class="sourceCode r"><span id="cb59-1"><a href="encounter.html#cb59-1"></a><span class="co"># select covariates for model</span></span>
<span id="cb59-2"><a href="encounter.html#cb59-2"></a>ebird_ss &lt;-<span class="st"> </span>ebird_ss <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb59-3"><a href="encounter.html#cb59-3"></a><span class="st">  </span><span class="kw">select</span>(species_observed,</span>
<span id="cb59-4"><a href="encounter.html#cb59-4"></a>         year, day_of_year,</span>
<span id="cb59-5"><a href="encounter.html#cb59-5"></a>         time_observations_started, duration_minutes,</span>
<span id="cb59-6"><a href="encounter.html#cb59-6"></a>         effort_distance_km, number_observers, </span>
<span id="cb59-7"><a href="encounter.html#cb59-7"></a>         <span class="kw">starts_with</span>(<span class="st">&quot;pland_&quot;</span>),</span>
<span id="cb59-8"><a href="encounter.html#cb59-8"></a>         <span class="kw">starts_with</span>(<span class="st">&quot;elevation_&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb59-9"><a href="encounter.html#cb59-9"></a><span class="st">  </span><span class="kw">drop_na</span>()</span></code></pre></div>
<p>Finally, we’ll hold 20% of the data aside so we have an independent test set, which we can later use to assess the performance of our model.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="encounter.html#cb60-1"></a><span class="co"># split 80/20</span></span>
<span id="cb60-2"><a href="encounter.html#cb60-2"></a>ebird_split &lt;-<span class="st"> </span>ebird_ss <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb60-3"><a href="encounter.html#cb60-3"></a><span class="st">  </span><span class="kw">split</span>(<span class="kw">if_else</span>(<span class="kw">runif</span>(<span class="kw">nrow</span>(.)) <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.8</span>, <span class="st">&quot;train&quot;</span>, <span class="st">&quot;test&quot;</span>))</span></code></pre></div>
<div class="exercise">
<h2>
Exercise
</h2>
<p>How would you modify the above code to include 25% of data in the test set?</p>
<button class="solution">Solution</button>
<div class="solution-content">
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="encounter.html#cb61-1"></a>ebird_split_<span class="dv">25</span> &lt;-<span class="st"> </span>ebird_ss <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb61-2"><a href="encounter.html#cb61-2"></a><span class="st">  </span><span class="kw">split</span>(<span class="kw">if_else</span>(<span class="kw">runif</span>(<span class="kw">nrow</span>(.)) <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.75</span>, <span class="st">&quot;train&quot;</span>, <span class="st">&quot;test&quot;</span>))</span></code></pre></div>
</div>
</div>
</div>
<div id="encounter-rf" class="section level2">
<h2><span class="header-section-number">10.2</span> Random forests</h2>
<p>Random forests are an excellent, general purpose machine learning method suitable for modeling encounter rate in a wide variety of scenarios. To address the issue of class imbalance, we’ll use a <strong>balanced random forest</strong> approach, a modification of the traditional random forest algorithm specifically designed to handle scenarios in which one class (in our case: species detections) is much more common than the other (non-detections). To implement a balanced random forest, we’ll first need to calculate the frequency of detections (the smaller class).</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="encounter.html#cb62-1"></a>detection_freq &lt;-<span class="st"> </span><span class="kw">mean</span>(ebird_split<span class="op">$</span>train<span class="op">$</span>species_observed)</span></code></pre></div>
<p>Now we can use the <a href="https://github.com/imbs-hl/ranger"><code>ranger</code></a> package to fit a random forest model to the eBird data.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r livecode"><code class="sourceCode r"><span id="cb63-1"><a href="encounter.html#cb63-1"></a><span class="co"># ranger requires a factor response to do classification</span></span>
<span id="cb63-2"><a href="encounter.html#cb63-2"></a>ebird_split<span class="op">$</span>train<span class="op">$</span>species_observed &lt;-<span class="st"> </span><span class="kw">factor</span>(ebird_split<span class="op">$</span>train<span class="op">$</span>species_observed)</span>
<span id="cb63-3"><a href="encounter.html#cb63-3"></a><span class="co"># grow random forest</span></span>
<span id="cb63-4"><a href="encounter.html#cb63-4"></a>rf &lt;-<span class="st"> </span><span class="kw">ranger</span>(<span class="dt">formula =</span>  species_observed <span class="op">~</span><span class="st"> </span>., </span>
<span id="cb63-5"><a href="encounter.html#cb63-5"></a>             <span class="dt">data =</span> ebird_split<span class="op">$</span>train,</span>
<span id="cb63-6"><a href="encounter.html#cb63-6"></a>             <span class="dt">importance =</span> <span class="st">&quot;impurity&quot;</span>,</span>
<span id="cb63-7"><a href="encounter.html#cb63-7"></a>             <span class="dt">probability =</span> <span class="ot">TRUE</span>,</span>
<span id="cb63-8"><a href="encounter.html#cb63-8"></a>             <span class="dt">replace =</span> <span class="ot">TRUE</span>, </span>
<span id="cb63-9"><a href="encounter.html#cb63-9"></a>             <span class="dt">sample.fraction =</span> <span class="kw">c</span>(detection_freq, detection_freq))</span></code></pre></div>
<div id="encounter-rf-assess" class="section level3">
<h3><span class="header-section-number">10.2.1</span> Model assessment</h3>
<p>To assess model quality, we’ll validate the model’s ability to predict the observed patterns of occurrence using independent validation data (i.e. the 20% test data set that we removed earlier). We’ll use a range of predictive performance metrics to compare the predictions to the actual observations. Different performance metrics reveal different aspects of the data and we can choose to emphasise some over others, depending on the specific goals of our analysis. For example, if we want to minimise the number of false negatives (i.e. we don’t want to miss any places where the species actually occurs), we would focus on sensitivity.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="encounter.html#cb64-1"></a><span class="co"># predict on test data</span></span>
<span id="cb64-2"><a href="encounter.html#cb64-2"></a>preds &lt;-<span class="st"> </span><span class="kw">predict</span>(rf, <span class="dt">data =</span> ebird_split<span class="op">$</span>test, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb64-3"><a href="encounter.html#cb64-3"></a><span class="co"># extract probability of detection</span></span>
<span id="cb64-4"><a href="encounter.html#cb64-4"></a>preds &lt;-<span class="st"> </span>preds<span class="op">$</span>predictions[, <span class="dv">2</span>]</span>
<span id="cb64-5"><a href="encounter.html#cb64-5"></a>rf_pred_test &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="kw">seq_along</span>(preds),</span>
<span id="cb64-6"><a href="encounter.html#cb64-6"></a>                           <span class="co"># actual detection/non-detection</span></span>
<span id="cb64-7"><a href="encounter.html#cb64-7"></a>                           <span class="dt">obs =</span> ebird_split<span class="op">$</span>test<span class="op">$</span>species_observed,</span>
<span id="cb64-8"><a href="encounter.html#cb64-8"></a>                           <span class="co"># predictions</span></span>
<span id="cb64-9"><a href="encounter.html#cb64-9"></a>                           <span class="dt">pred =</span> preds) <span class="op">%&gt;%</span></span>
<span id="cb64-10"><a href="encounter.html#cb64-10"></a><span class="st">  </span><span class="kw">drop_na</span>()</span>
<span id="cb64-11"><a href="encounter.html#cb64-11"></a></span>
<span id="cb64-12"><a href="encounter.html#cb64-12"></a><span class="co"># mean squared error (mse)</span></span>
<span id="cb64-13"><a href="encounter.html#cb64-13"></a>mse &lt;-<span class="st"> </span><span class="kw">mean</span>((rf_pred_test<span class="op">$</span>obs <span class="op">-</span><span class="st"> </span>rf_pred_test<span class="op">$</span>pred)<span class="op">^</span><span class="dv">2</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</span>
<span id="cb64-14"><a href="encounter.html#cb64-14"></a></span>
<span id="cb64-15"><a href="encounter.html#cb64-15"></a><span class="co"># pick threshold to maximize kappa</span></span>
<span id="cb64-16"><a href="encounter.html#cb64-16"></a>opt_thresh &lt;-<span class="st"> </span><span class="kw">optimal.thresholds</span>(rf_pred_test, <span class="dt">opt.methods =</span> <span class="st">&quot;MaxKappa&quot;</span>)</span>
<span id="cb64-17"><a href="encounter.html#cb64-17"></a></span>
<span id="cb64-18"><a href="encounter.html#cb64-18"></a><span class="co"># calculate accuracy metrics: auc, kappa, sensitivity, specificity, brier</span></span>
<span id="cb64-19"><a href="encounter.html#cb64-19"></a>pa_metrics &lt;-<span class="st"> </span><span class="kw">presence.absence.accuracy</span>(rf_pred_test,</span>
<span id="cb64-20"><a href="encounter.html#cb64-20"></a>                                        <span class="dt">threshold =</span> opt_thresh<span class="op">$</span>pred, </span>
<span id="cb64-21"><a href="encounter.html#cb64-21"></a>                                        <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, </span>
<span id="cb64-22"><a href="encounter.html#cb64-22"></a>                                        <span class="dt">st.dev =</span> <span class="ot">FALSE</span>)</span>
<span id="cb64-23"><a href="encounter.html#cb64-23"></a></span>
<span id="cb64-24"><a href="encounter.html#cb64-24"></a><span class="co"># combine various performance metrics together</span></span>
<span id="cb64-25"><a href="encounter.html#cb64-25"></a>rf_assessment &lt;-<span class="st"> </span><span class="kw">tibble</span>(</span>
<span id="cb64-26"><a href="encounter.html#cb64-26"></a>  <span class="dt">metric =</span> <span class="kw">c</span>(<span class="st">&quot;mse&quot;</span>, <span class="st">&quot;sensitivity&quot;</span>, <span class="st">&quot;specificity&quot;</span>, <span class="st">&quot;auc&quot;</span>, <span class="st">&quot;kappa&quot;</span>),</span>
<span id="cb64-27"><a href="encounter.html#cb64-27"></a>  <span class="dt">value =</span> <span class="kw">c</span>(mse, </span>
<span id="cb64-28"><a href="encounter.html#cb64-28"></a>            pa_metrics<span class="op">$</span>sensitivity, pa_metrics<span class="op">$</span>specificity, </span>
<span id="cb64-29"><a href="encounter.html#cb64-29"></a>            pa_metrics<span class="op">$</span>AUC, pa_metrics<span class="op">$</span>Kappa)</span>
<span id="cb64-30"><a href="encounter.html#cb64-30"></a>  )</span>
<span id="cb64-31"><a href="encounter.html#cb64-31"></a>knitr<span class="op">::</span><span class="kw">kable</span>(rf_assessment, <span class="dt">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">metric</th>
<th align="right">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">mse</td>
<td align="right">0.135</td>
</tr>
<tr class="even">
<td align="left">sensitivity</td>
<td align="right">0.485</td>
</tr>
<tr class="odd">
<td align="left">specificity</td>
<td align="right">0.927</td>
</tr>
<tr class="even">
<td align="left">auc</td>
<td align="right">0.852</td>
</tr>
<tr class="odd">
<td align="left">kappa</td>
<td align="right">0.337</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="encounter-habitat" class="section level2">
<h2><span class="header-section-number">10.3</span> Habitat associations</h2>
<p>From the random forest model, we can glean two important sources of information about the association between Wood Thrush detection and features of their local environment. First, <strong>predictor importance</strong> is a measure of the predictive power of each covariate, and is calculated as a byproduct of fitting a random forest model. Second, <strong>partial dependence</strong> plots estimate the marginal effect of one predictor holding all other predictors constant.</p>
<div id="encounter-habitat-pi" class="section level3">
<h3><span class="header-section-number">10.3.1</span> Predictor importance</h3>
<p>During the process of fitting a random forest model, some variables are removed at each node of the trees that make up the random forest. <strong>Predictor importance</strong> is based on the mean decrease in accuracy of the model when a given covariate is not used.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="encounter.html#cb65-1"></a>pi &lt;-<span class="st"> </span><span class="kw">enframe</span>(rf<span class="op">$</span>variable.importance, <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;importance&quot;</span>)</span>
<span id="cb65-2"><a href="encounter.html#cb65-2"></a><span class="co"># plots</span></span>
<span id="cb65-3"><a href="encounter.html#cb65-3"></a><span class="kw">ggplot</span>(pi) <span class="op">+</span><span class="st"> </span></span>
<span id="cb65-4"><a href="encounter.html#cb65-4"></a><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_reorder</span>(predictor, importance), <span class="dt">y =</span> importance) <span class="op">+</span></span>
<span id="cb65-5"><a href="encounter.html#cb65-5"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb65-6"><a href="encounter.html#cb65-6"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;#555555&quot;</span>) <span class="op">+</span></span>
<span id="cb65-7"><a href="encounter.html#cb65-7"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="op">+</span></span>
<span id="cb65-8"><a href="encounter.html#cb65-8"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb65-9"><a href="encounter.html#cb65-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, </span>
<span id="cb65-10"><a href="encounter.html#cb65-10"></a>       <span class="dt">y =</span> <span class="st">&quot;Predictor Importance (Gini Index)&quot;</span>) <span class="op">+</span></span>
<span id="cb65-11"><a href="encounter.html#cb65-11"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb65-12"><a href="encounter.html#cb65-12"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb65-13"><a href="encounter.html#cb65-13"></a>        <span class="dt">panel.grid.major.x =</span> <span class="kw">element_line</span>(<span class="dt">colour =</span> <span class="st">&quot;#cccccc&quot;</span>, <span class="dt">size =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="ebp-workshop_files/figure-html/encounter-habitat-pi-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
<div class="tip">
<h2>
Tip
</h2>
<p>Consult the file <code>data/mcd12q1_classes.csv</code> for a key to the different <code>pland_</code> variables.</p>
<p>class name<br />
—— ————————————
0 Water bodies<br />
1 Evergreen Needleleaf Forests<br />
2 Evergreen Broadleaf Forests<br />
3 Deciduous Needleleaf Forests<br />
4 Deciduous Broadleaf Forests<br />
5 Mixed Forests<br />
6 Closed Shrublands<br />
7 Open Shrublands<br />
8 Woody Savannas<br />
9 Savannas<br />
10 Grasslands<br />
11 Permanent Wetlands<br />
12 Croplands<br />
13 Urban and Built-up Lands<br />
14 Cropland/Natural Vegetation Mosaics
15 Non-Vegetated Lands<br />
255 Unclassified</p>
</div>
</div>
<div id="encounter-habitat-pd" class="section level3">
<h3><span class="header-section-number">10.3.2</span> Partial dependence</h3>
<p><strong>Partial dependence</strong> plots show the marginal effect of a given predictor on encounter rate averaged across the other predictors. We’ll use the R package <code>edarf</code> to construct partial dependence plots for the most important predictors.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="encounter.html#cb66-1"></a><span class="co"># top 9 predictors other than date</span></span>
<span id="cb66-2"><a href="encounter.html#cb66-2"></a>top_pred &lt;-<span class="st"> </span>pi <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb66-3"><a href="encounter.html#cb66-3"></a><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>predictor <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;day_of_year&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb66-4"><a href="encounter.html#cb66-4"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dt">n =</span> <span class="dv">9</span>, <span class="dt">wt =</span> importance) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb66-5"><a href="encounter.html#cb66-5"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(importance))</span>
<span id="cb66-6"><a href="encounter.html#cb66-6"></a></span>
<span id="cb66-7"><a href="encounter.html#cb66-7"></a><span class="co"># calculate partial dependence for each predictor</span></span>
<span id="cb66-8"><a href="encounter.html#cb66-8"></a>pd &lt;-<span class="st"> </span>top_pred <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb66-9"><a href="encounter.html#cb66-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pd =</span> <span class="kw">map</span>(predictor, partial_dependence, </span>
<span id="cb66-10"><a href="encounter.html#cb66-10"></a>                  <span class="dt">fit =</span> rf, <span class="dt">data =</span> ebird_split<span class="op">$</span>train),</span>
<span id="cb66-11"><a href="encounter.html#cb66-11"></a>         <span class="dt">pd =</span> <span class="kw">map</span>(pd, <span class="op">~</span><span class="st"> </span>.[, <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>)]),</span>
<span id="cb66-12"><a href="encounter.html#cb66-12"></a>         <span class="dt">pd =</span> <span class="kw">map</span>(pd, set_names, <span class="dt">nm =</span> <span class="kw">c</span>(<span class="st">&quot;value&quot;</span>,  <span class="st">&quot;encounter_rate&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb66-13"><a href="encounter.html#cb66-13"></a><span class="st">  </span><span class="kw">unnest</span>(<span class="dt">cols =</span> pd)</span>
<span id="cb66-14"><a href="encounter.html#cb66-14"></a></span>
<span id="cb66-15"><a href="encounter.html#cb66-15"></a><span class="co"># plot</span></span>
<span id="cb66-16"><a href="encounter.html#cb66-16"></a><span class="kw">ggplot</span>(pd) <span class="op">+</span></span>
<span id="cb66-17"><a href="encounter.html#cb66-17"></a><span class="st">  </span><span class="kw">aes</span>(<span class="dt">x =</span> value, <span class="dt">y =</span> encounter_rate) <span class="op">+</span></span>
<span id="cb66-18"><a href="encounter.html#cb66-18"></a><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></span>
<span id="cb66-19"><a href="encounter.html#cb66-19"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb66-20"><a href="encounter.html#cb66-20"></a><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span>percent) <span class="op">+</span></span>
<span id="cb66-21"><a href="encounter.html#cb66-21"></a><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span><span class="kw">as_factor</span>(predictor), <span class="dt">nrow =</span> <span class="dv">3</span>, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></span>
<span id="cb66-22"><a href="encounter.html#cb66-22"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="st">&quot;Encounter Rate&quot;</span>) <span class="op">+</span></span>
<span id="cb66-23"><a href="encounter.html#cb66-23"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb66-24"><a href="encounter.html#cb66-24"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb66-25"><a href="encounter.html#cb66-25"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb66-26"><a href="encounter.html#cb66-26"></a>        <span class="dt">axis.line =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;grey60&quot;</span>),</span>
<span id="cb66-27"><a href="encounter.html#cb66-27"></a>        <span class="dt">axis.ticks  =</span> <span class="kw">element_line</span>(<span class="dt">color =</span> <span class="st">&quot;grey60&quot;</span>))</span></code></pre></div>
<p><img src="ebp-workshop_files/figure-html/encounter-habitat-pd-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="encounter-predict" class="section level2">
<h2><span class="header-section-number">10.4</span> Prediction</h2>
<p>Finally, we can use the random forest model to make a map of Wood Thrush encounter rate in BCR 27! The data package contains a prediction surface consisting of the PLAND habitat covariates summarized on a regular grid of points across BCR 27. We’ll make predictions of encounter rate at these points. However, first we need to bring effort variables into this prediction surface. We’ll make predictions for a <strong>standard eBird checklist</strong>: a 1 km, 1 hour traveling count at the peak time of day for detecting this species.</p>
<p>To find the time of day with the highest detection probability, we can look for the peak of the partial dependence plot, constraining the search to times of day for which there are enough data to make reasonable predictions (hours with at least 1% of checklists).</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="encounter.html#cb67-1"></a><span class="co"># find peak time of day from partial dependence</span></span>
<span id="cb67-2"><a href="encounter.html#cb67-2"></a>pd_time &lt;-<span class="st"> </span><span class="kw">partial_dependence</span>(rf, </span>
<span id="cb67-3"><a href="encounter.html#cb67-3"></a>                              <span class="dt">vars =</span> <span class="st">&quot;time_observations_started&quot;</span>, </span>
<span id="cb67-4"><a href="encounter.html#cb67-4"></a>                              <span class="co"># make estimates at 30 minute intervals</span></span>
<span id="cb67-5"><a href="encounter.html#cb67-5"></a>                              <span class="co"># use the entire training dataset for estimation</span></span>
<span id="cb67-6"><a href="encounter.html#cb67-6"></a>                              <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">24</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span>, <span class="kw">nrow</span>(ebird_split<span class="op">$</span>train)), </span>
<span id="cb67-7"><a href="encounter.html#cb67-7"></a>                              <span class="dt">data =</span> ebird_split<span class="op">$</span>train) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb67-8"><a href="encounter.html#cb67-8"></a><span class="st">  </span><span class="kw">select</span>(time_observations_started, <span class="dt">encounter_rate =</span> <span class="st">&quot;TRUE&quot;</span>)</span>
<span id="cb67-9"><a href="encounter.html#cb67-9"></a></span>
<span id="cb67-10"><a href="encounter.html#cb67-10"></a><span class="co"># hours with at least 1% of checklists</span></span>
<span id="cb67-11"><a href="encounter.html#cb67-11"></a>search_hours &lt;-<span class="st"> </span>ebird_split<span class="op">$</span>train <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb67-12"><a href="encounter.html#cb67-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hour =</span> <span class="kw">floor</span>(time_observations_started)) <span class="op">%&gt;%</span></span>
<span id="cb67-13"><a href="encounter.html#cb67-13"></a><span class="st">  </span><span class="kw">count</span>(hour) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb67-14"><a href="encounter.html#cb67-14"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pct =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb67-15"><a href="encounter.html#cb67-15"></a><span class="st">  </span><span class="kw">filter</span>(pct <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.01</span>)</span>
<span id="cb67-16"><a href="encounter.html#cb67-16"></a></span>
<span id="cb67-17"><a href="encounter.html#cb67-17"></a><span class="co"># constrained peak time</span></span>
<span id="cb67-18"><a href="encounter.html#cb67-18"></a>t_peak &lt;-<span class="st"> </span>pd_time <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb67-19"><a href="encounter.html#cb67-19"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">floor</span>(time_observations_started) <span class="op">%in%</span><span class="st"> </span>search_hours<span class="op">$</span>hour) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb67-20"><a href="encounter.html#cb67-20"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">1</span>, <span class="dt">wt =</span> <span class="kw">desc</span>(time_observations_started)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb67-21"><a href="encounter.html#cb67-21"></a><span class="st">  </span><span class="kw">pull</span>(time_observations_started)</span>
<span id="cb67-22"><a href="encounter.html#cb67-22"></a>t_peak</span>
<span id="cb67-23"><a href="encounter.html#cb67-23"></a><span class="co">#&gt; [1] 5.08</span></span></code></pre></div>
<p>Based on this analysis, the best time for detecting Wood Thrush is at 5:05 AM. Now we can use this time to make predictions.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r livecode"><code class="sourceCode r"><span id="cb68-1"><a href="encounter.html#cb68-1"></a><span class="co"># add effort covariates to prediction </span></span>
<span id="cb68-2"><a href="encounter.html#cb68-2"></a>pred_surface_eff &lt;-<span class="st"> </span>pred_surface <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb68-3"><a href="encounter.html#cb68-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">observation_date =</span> <span class="kw">ymd</span>(<span class="st">&quot;2018-06-15&quot;</span>),</span>
<span id="cb68-4"><a href="encounter.html#cb68-4"></a>         <span class="dt">year =</span> <span class="kw">year</span>(observation_date),</span>
<span id="cb68-5"><a href="encounter.html#cb68-5"></a>         <span class="dt">day_of_year =</span> <span class="kw">yday</span>(observation_date),</span>
<span id="cb68-6"><a href="encounter.html#cb68-6"></a>         <span class="dt">time_observations_started =</span> t_peak,</span>
<span id="cb68-7"><a href="encounter.html#cb68-7"></a>         <span class="dt">duration_minutes =</span> <span class="dv">60</span>,</span>
<span id="cb68-8"><a href="encounter.html#cb68-8"></a>         <span class="dt">effort_distance_km =</span> <span class="dv">1</span>,</span>
<span id="cb68-9"><a href="encounter.html#cb68-9"></a>         <span class="dt">number_observers =</span> <span class="dv">1</span>)</span>
<span id="cb68-10"><a href="encounter.html#cb68-10"></a></span>
<span id="cb68-11"><a href="encounter.html#cb68-11"></a><span class="co"># predict</span></span>
<span id="cb68-12"><a href="encounter.html#cb68-12"></a>pred_rf &lt;-<span class="st"> </span><span class="kw">predict</span>(rf, <span class="dt">data =</span> pred_surface_eff, <span class="dt">type =</span> <span class="st">&quot;response&quot;</span>)</span>
<span id="cb68-13"><a href="encounter.html#cb68-13"></a>pred_rf &lt;-<span class="st"> </span>pred_rf<span class="op">$</span>predictions[, <span class="dv">2</span>]</span>
<span id="cb68-14"><a href="encounter.html#cb68-14"></a><span class="co"># add to prediction surface</span></span>
<span id="cb68-15"><a href="encounter.html#cb68-15"></a>pred_er &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(pred_surface_eff, <span class="dt">encounter_rate =</span> pred_rf) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb68-16"><a href="encounter.html#cb68-16"></a><span class="st">  </span><span class="kw">select</span>(latitude, longitude, encounter_rate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb68-17"><a href="encounter.html#cb68-17"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">encounter_rate =</span> <span class="kw">pmin</span>(<span class="kw">pmax</span>(encounter_rate, <span class="dv">0</span>), <span class="dv">1</span>))</span></code></pre></div>
<p>Next, we’ll convert this data frame to spatial features using <code>sf</code>, then rasterize the points using the prediction surface raster template.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r livecode"><code class="sourceCode r"><span id="cb69-1"><a href="encounter.html#cb69-1"></a><span class="co"># rasterize predictions</span></span>
<span id="cb69-2"><a href="encounter.html#cb69-2"></a>r_pred &lt;-<span class="st"> </span>pred_er <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-3"><a href="encounter.html#cb69-3"></a><span class="st">  </span><span class="co"># convert to spatial features</span></span>
<span id="cb69-4"><a href="encounter.html#cb69-4"></a><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>), <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-5"><a href="encounter.html#cb69-5"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs =</span> <span class="kw">projection</span>(r)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb69-6"><a href="encounter.html#cb69-6"></a><span class="st">  </span><span class="co"># rasterize</span></span>
<span id="cb69-7"><a href="encounter.html#cb69-7"></a><span class="st">  </span><span class="kw">rasterize</span>(r)</span>
<span id="cb69-8"><a href="encounter.html#cb69-8"></a>r_pred &lt;-<span class="st"> </span>r_pred[[<span class="op">-</span><span class="dv">1</span>]]</span></code></pre></div>
<p>Finally, we can map these predictions!</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="encounter.html#cb70-1"></a><span class="co"># project predictions</span></span>
<span id="cb70-2"><a href="encounter.html#cb70-2"></a>r_pred_proj &lt;-<span class="st"> </span><span class="kw">projectRaster</span>(r_pred, <span class="dt">crs =</span> map_proj<span class="op">$</span>proj4string, <span class="dt">method =</span> <span class="st">&quot;ngb&quot;</span>)</span>
<span id="cb70-3"><a href="encounter.html#cb70-3"></a></span>
<span id="cb70-4"><a href="encounter.html#cb70-4"></a><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="fl">3.5</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>))</span>
<span id="cb70-5"><a href="encounter.html#cb70-5"></a><span class="co"># set up plot area</span></span>
<span id="cb70-6"><a href="encounter.html#cb70-6"></a><span class="kw">plot</span>(bcr, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="ot">NA</span>)</span>
<span id="cb70-7"><a href="encounter.html#cb70-7"></a><span class="kw">plot</span>(ne_land, <span class="dt">col =</span> <span class="st">&quot;#dddddd&quot;</span>, <span class="dt">border =</span> <span class="st">&quot;#888888&quot;</span>, <span class="dt">lwd =</span> <span class="fl">0.5</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb70-8"><a href="encounter.html#cb70-8"></a></span>
<span id="cb70-9"><a href="encounter.html#cb70-9"></a><span class="co"># encounter rate</span></span>
<span id="cb70-10"><a href="encounter.html#cb70-10"></a>r_max &lt;-<span class="st"> </span><span class="kw">ceiling</span>(<span class="dv">10</span> <span class="op">*</span><span class="st"> </span><span class="kw">cellStats</span>(r_pred_proj, max)) <span class="op">/</span><span class="st"> </span><span class="dv">10</span></span>
<span id="cb70-11"><a href="encounter.html#cb70-11"></a>brks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, r_max, <span class="dt">by =</span> <span class="fl">0.025</span>)</span>
<span id="cb70-12"><a href="encounter.html#cb70-12"></a>lbl_brks &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, r_max, <span class="dt">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb70-13"><a href="encounter.html#cb70-13"></a><span class="co"># ebird status and trends color palette</span></span>
<span id="cb70-14"><a href="encounter.html#cb70-14"></a>pal &lt;-<span class="st"> </span><span class="kw">abundance_palette</span>(<span class="kw">length</span>(brks) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</span>
<span id="cb70-15"><a href="encounter.html#cb70-15"></a><span class="kw">plot</span>(r_pred_proj, </span>
<span id="cb70-16"><a href="encounter.html#cb70-16"></a>     <span class="dt">col =</span> pal, <span class="dt">breaks =</span> brks, </span>
<span id="cb70-17"><a href="encounter.html#cb70-17"></a>     <span class="dt">maxpixels =</span> <span class="kw">ncell</span>(r_pred_proj),</span>
<span id="cb70-18"><a href="encounter.html#cb70-18"></a>     <span class="dt">legend =</span> <span class="ot">FALSE</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb70-19"><a href="encounter.html#cb70-19"></a></span>
<span id="cb70-20"><a href="encounter.html#cb70-20"></a><span class="co"># borders</span></span>
<span id="cb70-21"><a href="encounter.html#cb70-21"></a><span class="kw">plot</span>(bcr, <span class="dt">border =</span> <span class="st">&quot;#000000&quot;</span>, <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">lwd =</span> <span class="dv">1</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb70-22"><a href="encounter.html#cb70-22"></a><span class="kw">plot</span>(ne_state_lines, <span class="dt">col =</span> <span class="st">&quot;#ffffff&quot;</span>, <span class="dt">lwd =</span> <span class="fl">0.75</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb70-23"><a href="encounter.html#cb70-23"></a><span class="kw">plot</span>(ne_country_lines, <span class="dt">col =</span> <span class="st">&quot;#ffffff&quot;</span>, <span class="dt">lwd =</span> <span class="fl">1.5</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</span>
<span id="cb70-24"><a href="encounter.html#cb70-24"></a><span class="kw">box</span>()</span>
<span id="cb70-25"><a href="encounter.html#cb70-25"></a></span>
<span id="cb70-26"><a href="encounter.html#cb70-26"></a><span class="co"># legend</span></span>
<span id="cb70-27"><a href="encounter.html#cb70-27"></a><span class="kw">par</span>(<span class="dt">new =</span> <span class="ot">TRUE</span>, <span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb70-28"><a href="encounter.html#cb70-28"></a>title &lt;-<span class="st"> &quot;Wood Thrush Encounter Rate&quot;</span></span>
<span id="cb70-29"><a href="encounter.html#cb70-29"></a><span class="kw">image.plot</span>(<span class="dt">zlim =</span> <span class="kw">range</span>(brks), <span class="dt">legend.only =</span> <span class="ot">TRUE</span>, </span>
<span id="cb70-30"><a href="encounter.html#cb70-30"></a>           <span class="dt">col =</span> pal, <span class="dt">breaks =</span> brks,</span>
<span id="cb70-31"><a href="encounter.html#cb70-31"></a>           <span class="dt">smallplot =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>, <span class="fl">0.06</span>, <span class="fl">0.09</span>),</span>
<span id="cb70-32"><a href="encounter.html#cb70-32"></a>           <span class="dt">horizontal =</span> <span class="ot">TRUE</span>,</span>
<span id="cb70-33"><a href="encounter.html#cb70-33"></a>           <span class="dt">axis.args =</span> <span class="kw">list</span>(<span class="dt">at =</span> lbl_brks, <span class="dt">labels =</span> lbl_brks,</span>
<span id="cb70-34"><a href="encounter.html#cb70-34"></a>                            <span class="dt">fg =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">col.axis =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb70-35"><a href="encounter.html#cb70-35"></a>                            <span class="dt">cex.axis =</span> <span class="fl">0.75</span>, <span class="dt">lwd.ticks =</span> <span class="fl">0.5</span>,</span>
<span id="cb70-36"><a href="encounter.html#cb70-36"></a>                            <span class="dt">padj =</span> <span class="fl">-1.5</span>),</span>
<span id="cb70-37"><a href="encounter.html#cb70-37"></a>           <span class="dt">legend.args =</span> <span class="kw">list</span>(<span class="dt">text =</span> title,</span>
<span id="cb70-38"><a href="encounter.html#cb70-38"></a>                              <span class="dt">side =</span> <span class="dv">3</span>, <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb70-39"><a href="encounter.html#cb70-39"></a>                              <span class="dt">cex =</span> <span class="dv">1</span>, <span class="dt">line =</span> <span class="dv">0</span>))</span></code></pre></div>
<p><img src="ebp-workshop_files/figure-html/encounter-predict-map-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>
</div>
<div id="encouter-exercises" class="section level2">
<h2><span class="header-section-number">10.5</span> Exercises</h2>
<p>Now that you’ve completed this lesson, try modifying your script to complete at least one of the following exercises:</p>
<ol style="list-style-type: decimal">
<li><p>How does changing the subsampling grid cell size affect the model performance?</p></li>
<li><p>What happens to the predictions if you make them for an eBirder traveling further than 1 km, or birding for longer than 1 hour?</p></li>
<li><p>Filter the data to only shorter duration checklists or shorter distances traveled. How does this affect model performance?</p></li>
<li><p>An alternative approach to dealing with class imbalance, is to grid sample only the non-detections, while keeping all the detections. Try this subsampling approach and see what the affect is on the predictive performance metrics.</p></li>
</ol>

</div>
</div>
<script>
var coll = document.getElementsByClassName("solution");
var i;

for (i = 0; i < coll.length; i++) {
  coll[i].addEventListener("click", function() {
    this.classList.toggle("active");
    var content = this.nextElementSibling;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}
</script>
            </section>

          </div>
        </div>
      </div>
<a href="model-intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="occupancy.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/mstrimas/ebp-workshop/edit/master/10_encounter.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
